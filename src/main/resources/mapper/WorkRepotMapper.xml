<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.lyc.cms.mapper.WorkRepotMapper">
    <resultMap id="WorkRepot" type="jp.co.lyc.cms.model.WorkRepotModel"/>
    <select id="selectWorkRepot" resultMap="WorkRepot" parameterType="String">
		SELECT
			attendanceYearAndMonth,
			workingTimeReport,
			sumWorkTime,
			updateUser,
			updateTime,
			approvalStatus
		FROM 
			T018WorkTotalTime
		WHERE
			attendanceRegisterFlag = 0 AND
			employeeNo = #{employeeNo}
		ORDER BY
			attendanceYearAndMonth
		DESC
    </select>
	<update id="updateWorkRepot" parameterType="String">
		UPDATE T018WorkTotalTime
		SET 
			updateTime= now(),
			sumWorkTime = #{sumWorkTime},
			approvalStatus = 1
		WHERE 
			employeeNo = #{employeeNo}
			and attendanceYearAndMonth = #{attendanceYearAndMonth}
    </update> 
   	<insert id="insertWorkRepot" parameterType="String">
    	insert into 
    		T018WorkTotalTime(workingTimeReport,updateTime,updateUser,approvalStatus,createTime,employeeNo,attendanceYearAndMonth,attendanceRegisterFlag)
			values(#{workingTimeReport},now(),#{employeeName},0,now(),#{employeeName},#{attendanceYearAndMonth},0)
		on DUPLICATE key update
			workingTimeReport = #{workingTimeReport},
			updateTime= now(),
			updateUser = #{employeeName}

    </insert> 
</mapper>