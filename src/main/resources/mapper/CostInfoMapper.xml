<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.lyc.cms.mapper.CostInfoMapper">
    <resultMap id="Cost" type="jp.co.lyc.cms.model.CostInfoModel"/>
    <resultMap id="MapResult" type="map"/>
    <!-- 諸費用検索 -->
    <select id="selectCost" parameterType="String" resultMap="Cost">
        SELECT
			T005.employeeNo,
			T005.reflectYearAndMonth,
			T005.SocialInsuranceFlag,
			T005.salary,
			T005.waitingCost,
			T005.welfarePensionAmount,
			T005.healthInsuranceAmount,
			T005.insuranceFeeAmount,
			T005.lastTimeBonusAmount,
			T005.scheduleOfBonusAmount,
			T005.transportationExpenses,
			T005.bonusFlag,
			T005.nextBonusMonth,
			T005.monthOfCompanyPay,
			T005.nextRaiseMonth,
			T005.otherAllowance,
			T005.otherAllowanceAmount,
			T005.leaderAllowanceAmount,
			T005.totalAmount,
			T005.housingStatus,
			T005.remark,
			T005.employeeFormCode,
			T005.housingAllowance,
			M005.employeeFormName
		FROM
			T005ExpensesInfo AS T005
		LEFT JOIN 
			M005EmployeeForm AS M005
		ON
			T005.employeeFormCode = M005.employeeFormCode
		WHERE
			employeeNo = #{employeeNo}
		<if test="reflectYearAndMonth != null">
			reflectYearAndMonth = #{reflectYearAndMonth},
		</if>
    </select>
    <!-- 稼働の判断 -->
    <select id="checkKado" parameterType="String" resultMap="MapResult">
        SELECT
			AdmissionStartDate,
			AdmissionEndDate,
			siteRoleCode,
			RelatedEmployees 
		FROM
			T006EmployeeSiteInfo 
		WHERE
			employeeNo = #{employeeNo} 
			AND AdmissionStartDate IS NULL 
			AND AdmissionEndDate IS NULL
    </select>
    <!-- 諸費用情報インサート -->
	<insert id="insertCost" parameterType="String">
		INSERT INTO T005ExpensesInfo(
		employeeNo,
		reflectYearAndMonth,
		SocialInsuranceFlag,
		salary,
		waitingCost,
		welfarePensionAmount,
		healthInsuranceAmount,
		insuranceFeeAmount,
		lastTimeBonusAmount,
		scheduleOfBonusAmount,
		transportationExpenses,
		bonusFlag,
		nextBonusMonth,
		monthOfCompanyPay,
		nextRaiseMonth,
		otherAllowance,
		otherAllowanceAmount,
		leaderAllowanceAmount,
		totalAmount,
		housingStatus,
		remark,
		employeeFormCode,
		housingAllowance,
		updateTime,
		createTime,
		updateUser 
		)  
		VALUE(
		#{employeeNo},
		#{reflectYearAndMonth},
		#{SocialInsuranceFlag},
		#{salary},
		#{waitingCost},
		#{welfarePensionAmount},
		#{healthInsuranceAmount},
		#{insuranceFeeAmount},
		#{lastTimeBonusAmount},
		#{scheduleOfBonusAmount},
		#{transportationExpenses},
		#{bonusFlag},
		#{nextBonusMonth},
		#{monthOfCompanyPay},
		#{nextRaiseMonth},
		#{otherAllowance},
		#{otherAllowanceAmount},
		#{leaderAllowanceAmount},
		#{totalAmount},
		#{housingStatus},
		#{remark},
		#{employeeFormCode},
		#{housingAllowance},
		NOW(),
		NOW(),
		#{updateUser})
    </insert>
    <!-- 諸費用情報アップデート -->
    <update id="updateCost" parameterType="String">
		UPDATE T005ExpensesInfo
		SET 
		<if test="reflectYearAndMonth != null">
			reflectYearAndMonth = #{reflectYearAndMonth},
		</if>
		<if test="SocialInsuranceFlag != null">
			SocialInsuranceFlag = #{SocialInsuranceFlag},
		</if>
		<if test="salary != null">
			salary = #{salary},
		</if>
		<if test="waitingCost != null">
			waitingCost = #{waitingCost},
		</if>
		<if test="welfarePensionAmount != null">
			welfarePensionAmount = #{welfarePensionAmount},
		</if>
		<if test="healthInsuranceAmount != null">
			healthInsuranceAmount = #{healthInsuranceAmount},
		</if>
		<if test="insuranceFeeAmount != null">
			insuranceFeeAmount = #{insuranceFeeAmount},
		</if>
		<if test="lastTimeBonusAmount != null">
			lastTimeBonusAmount = #{lastTimeBonusAmount},
		</if>
		<if test="scheduleOfBonusAmount != null">
			scheduleOfBonusAmount = #{scheduleOfBonusAmount},
		</if>
		<if test="transportationExpenses != null">
			transportationExpenses = #{transportationExpenses},
		</if>
		<if test="bonusFlag != null">
			bonusFlag = #{bonusFlag},
		</if>
		<if test="nextBonusMonth != null">
			nextBonusMonth = #{nextBonusMonth},
		</if>
		<if test="monthOfCompanyPay != null">
			monthOfCompanyPay = #{monthOfCompanyPay},
		</if>
		<if test="nextRaiseMonth != null">
			nextRaiseMonth = #{nextRaiseMonth},
		</if>
		<if test="otherAllowance != null">
			otherAllowance = #{otherAllowance},
		</if>
		<if test="otherAllowanceAmount != null">
			otherAllowanceAmount = #{otherAllowanceAmount},
		</if>
		<if test="leaderAllowanceAmount != null">
			leaderAllowanceAmount = #{leaderAllowanceAmount},
		</if>
		<if test="totalAmount != null">
			totalAmount = #{totalAmount},
		</if>
		<if test="housingStatus != null">
			housingStatus = #{housingStatus},
		</if>
		<if test="remark != null">
			remark = #{remark},
		</if>
		<if test="employeeFormCode != null">
			employeeFormCode = #{employeeFormCode},
		</if>
		<if test="housingAllowance != null">
			housingAllowance = #{housingAllowance},
		</if>
		updateTime = NOW(),
		updateUser = #{updateUser}
		WHERE 
			employeeNo = #{employeeNo}
		AND
			reflectYearAndMonth = #{updatedReflectYearAndMonth}
    </update>
    <!--　　諸費用を削除 -->
	<delete id="deleteCostInfo" parameterType="String">
		DELETE
		FROM
		T005ExpensesInfo
		WHERE
		employeeNo = #{employeeNo};
	</delete>
</mapper>