<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.lyc.cms.mapper.SalesSituationMapper">
    <resultMap id="SalesSituation" type="jp.co.lyc.cms.model.SalesSituationModel"/>
    <!-- 初期表示 -->
    <select id="getSalesSituationModel" parameterType="String" resultType="jp.co.lyc.cms.model.SalesSituationModel">
SELECT 
    T001.employeeNo,
    CONCAT(T001.employeeFristName,
            T001.employeeLastName) AS 'employeeName',
    M013.stationName AS 'nearestStation',
    CONCAT_WS(',',
            T002.developLanguage1,
            T002.developLanguage2,
            T002.developLanguage3,
            T002.developLanguage4,
            T002.developLanguage5) AS 'developLanguage',
    T006.siteRoleCode,
    T006.unitPrice,
    T006.admissionEndDate,
    1 AS 'salesProgressCode',
    T010.salesYearAndMonth,
    T010.interviewDate1,
    T010.stationCode1,
    T010.interviewCustomer1,
    T010.interviewDate2,
    T010.stationCode2,
    T010.interviewCustomer2,
    T010.hopeLowestPrice,
    T010.hopeHighestPrice,
    T010.salesProgressCode,
    T010.remark,
    T010.salesStaff
FROM
    T001Employee T001
        LEFT JOIN
    T003AddressInfo T003 ON T001.employeeNo = T003.employeeNo
        LEFT JOIN
    M013Station M013 ON M013.stationCode = T003.stationCode1
        LEFT JOIN
    T002EmployeeDetail T002 ON T001.employeeNo = T002.employeeNo
        LEFT JOIN
    T006EmployeeSiteInfo T006 ON T001.employeeNo = T006.employeeNo
            LEFT JOIN
    T010SalesSituation T010 ON T001.employeeNo = T010.employeeNo
WHERE
    LEFT(T006.admissionEndDate, 6) = #{sysDate}
    </select>
    
    <!-- 営業情報を更新 -->
	<insert id="insertSalesSituation" parameterType="String">
		INSERT INTO T010SalesSituation
		(employeeNo,
		salesYearAndMonth,
		interviewDate1,
		stationCode1,
		interviewCustomer1,
		interviewDate2,
		stationCode2,
		interviewCustomer2,
		hopeLowestPrice,
		hopeHighestPrice,
		salesProgressCode,
		remark,
		salesStaff,
		updateTime,
		createTime,
		updateUser)
		VALUES
		(
		#{employeeNo},
		#{salesYearAndMonth},
		#{interviewDate1},
		#{interviewLocation1},
		#{interviewCustomer1},
		#{interviewDate2},
		#{interviewLocation2},
		#{interviewCustomer2},
		#{hopeLowestPrice},
		#{hopeHighestPrice},
		#{salesProgressCode},
		#{remark},
		#{salesStaff},
		 NOW(),
		 NOW(),
		#{updateUser})
		ON DUPLICATE KEY UPDATE 
			interviewDate1=#{interviewDate1},
			stationCode1=#{interviewLocation1},
			interviewCustomer1=#{interviewCustomer1},
			interviewDate2=#{interviewDate2},
			stationCode2=#{interviewLocation2},
			interviewCustomer2=#{interviewCustomer2},
			hopeLowestPrice=#{hopeLowestPrice},
			hopeHighestPrice=#{hopeHighestPrice},
			salesProgressCode=#{salesProgressCode},
			remark=#{remark},
			salesStaff=#{salesStaff},
			updateTime= NOW(),
			createTime= NOW(),
			updateUser=#{updateUser}

	</insert>
</mapper>