<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.co.lyc.cms.mapper.CostRegistrationMapper">
    <resultMap id="CostRegistration" type="jp.co.lyc.cms.model.CostRegistrationModel"/>
    <select id="selectCostRegistration" resultMap="CostRegistration" parameterType="String">
		SELECT
			(@rowNo:=@rowNo + 1) AS rowNo,
			employeeNo,
			happendDate,
			costClassificationCode,
			dueDate,
			detailedName,
			stationCode,
			originCode,
			transportationCode,
			destinationCode,
			cost,
			remark,
			roundCode,
			CONVERT (costFile USING utf8)costFile,
			updateTime,
			createTime,
			updateUser
		FROM 
			T020CostInfo
			,(SELECT   @rowNo:=0) AS rowNo
		WHERE
			happendDate &lt;= date_format(date_add(NOW(), interval 2 MONTH) ,'%Y%m%d') AND
			employeeNo = #{employeeNo}
    </select>
    <insert id="insertCostRegistration" parameterType="String">
	INSERT INTO
		T020CostInfo(
			employeeNo,
			happendDate,
			costClassificationCode,
			dueDate,
			detailedName,
			stationCode,
			originCode,
			transportationCode,
			destinationCode,
			cost,
			remark,
			roundCode,
			costFile,
			updateTime,
			createTime,
			updateUser)
		VALUES(
			{employeeNo},
			{happendDate},
			{costClassificationCode},
			{dueDate},
			{detailedName},
			{stationCode},
			{originCode},
			{transportationCode},
			{destinationCode},
			{cost},
			{remark},
			{roundCode},
			{costFile},
			NOW(),
			NOW(),
			#{updateUser}
		)
    </insert>
	<update id="updateCostRegistration" parameterType="String">
		UPDATE T020CostInfo
		SET 
			employeeNo = #{employeeNo},
			happendDate = #{happendDate},
			costClassificationCode = #{costClassificationCode},
			dueDate = #{dueDate},
			detailedName = #{detailedName},
			stationCode = #{stationCode},
			originCode = #{originCode},
			transportationCode = #{transportationCode},
			destinationCode = #{destinationCode},
			cost = #{cost},
			remark = #{remark},
			roundCode = #{roundCode},
			costFile = #{costFile},
			updateTime =now(),
			createTime =now(),
			updateUser = #{employeeName}
		WHERE 
			employeeNo = #{employeeNo}
			and attendanceYearAndMonth = #{attendanceYearAndMonth}
    </update>

</mapper>